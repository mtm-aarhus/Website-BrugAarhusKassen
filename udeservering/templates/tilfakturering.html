{% extends "common.html" %}
{% block content %}
<div class="table-responsive">
  <table id="tilfakturering-table"
         data-toggle="table"
         data-pagination="true"
         data-search="true"
         data-url="{{ url_for('udeservering.api_udeservering_tilfakturering') }}"
         data-page-size="25"
         data-unique-id="Id">
    <thead>
      <tr>
        <th data-field="Id" data-formatter="linkFormatter">ID</th>
        <th data-field="Firmanavn">Firmanavn</th>
        <th data-field="Adresse">Adresse</th>
        <th data-field="CVR">CVR</th>
        <th data-field="Serveringszone">Zone</th>
        <th data-field="Lokation">Lokation</th>
        <th data-field="Serveringsareal" data-formatter="arealFormatter">Areal</th>
        <th data-field="Facadelaengde" data-formatter="facadeFormatter">Facadelængde</th>
        <th data-field="Faktureringsmaaned">Faktureringsmåned</th>
        <th data-formatter="actionFormatter">Handling</th>
      </tr>
    </thead>
  </table>
</div>
{% endblock %}

{% block extra_js %}
<script>
function actionFormatter(value, row) {
  return `
    <button class="btn btn-sm btn-warning" onclick="updateStatus(${row.Id}, 'Ny')">
      <i class="bi bi-arrow-counterclockwise"></i> Fortryd
    </button>`;
}

function updateStatus(id, newStatus) {
  if (!confirm("Vil du fortryde fakturering?")) return;

  fetch("{{ url_for('udeservering.api_udeservering_set_status') }}", {
    method: "POST",
    headers: { "Content-Type": "application/json" },
    body: JSON.stringify({ Id: id, NewStatus: newStatus })
  })
  .then(r => r.json())
  .then(data => {
    if (data.success) {
      $('#tilfakturering-table').bootstrapTable('refresh');
    } else {
      alert("Kunne ikke ændre status.");
    }
  });
}
</script>
{% endblock %}

{% extends "udeservering.html" %}

{% block content %}

<h4 class="mb-3">Udeservering – Ansøgninger</h4>

<div id="toolbar">
  <select id="filterSelect" class="form-select form-select-sm" style="width: 200px;">
    <option value="aktive" selected>Aktive</option>
    <option value="inaktive">Inaktive</option>
    <option value="alle">Alle</option>
  </select>
</div>
<div class="table-responsive">
  <table id="applications-table"
    class="table table-striped table-bordered align-middle"
    data-toolbar="#toolbar"
    data-toggle="table"
    data-pagination="true"
    data-side-pagination="server"
    data-search="true"
    data-url="{{ url_for('udeservering.api_udeservering_applications') }}"
    data-page-size="25"
    data-sort-name="Id"
    data-sort-order="desc"
    data-unique-id="Id"
    data-total-field="total"
    data-data-field="rows">
    <thead>
      <tr>
        <th data-field="Id" data-formatter="linkFormatter">ID</th>
        <th data-field="Firmanavn">Firmanavn</th>
        <th data-field="Adresse">Adresse</th>
        <th data-field="CVR">CVR</th>
        <th data-field="Serveringszone">Zone</th>
        <th data-field="Lokation">Lokation</th>
        <th data-field="Serveringsareal" data-formatter="arealFormatter">Areal</th>
        <th data-field="Facadelaengde" data-formatter="facadeFormatter">Facade</th>
        <th data-field="Periodetype">Periodetype</th>
        <th data-field="Ansogningsdato" data-formatter="dateFormatter">Ansøgningsdato</th>
        <th data-field="MaanederIndevaerende" data-formatter="monthFormatter">Måneder indeværende år</th>
        <th data-field="MaanederFremtidige" data-formatter="monthFormatter">Måneder fremtidige år</th>
      </tr>
    </thead>
  </table>
</div>
{% endblock %}

{% block extra_js %}
<script>

  $("#filterSelect").on("change", function() {
    const filter = $(this).val();
    const url = "{{ url_for('udeservering.api_udeservering_applications') }}" + "?filter=" + filter;

    $("#applications-table").bootstrapTable("refresh", { url: url });
  });

  function dateFormatter(value) {
      if (!value) return "";
      try {
          const d = new Date(value);
          const day = String(d.getDate()).padStart(2, "0");
          const month = String(d.getMonth() + 1).padStart(2, "0");
          const year = d.getFullYear();
          return `${day}-${month}-${year}`;
      } catch {
          return value;
      }
  }


</script>
{% endblock %}
